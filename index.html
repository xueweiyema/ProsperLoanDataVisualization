<!DOCTYPE html>
<meta charset="utf-8">
<style>

    label {
        display: block;
    }

    .bar {
        fill: steelblue;
    }

    .bar:hover {
        fill: brown;
    }

    .axis--x path {
        display: none;
    }

    h1 {
        text-align: center;
        color: black;
    }
</style>

<body>
    <h1></h1>
    <form>
        <label>
            <input type="radio" name="mode" value="grouped"> Grouped</label>
        <label>
            <input type="radio" name="mode" value="stacked" checked> Stacked</label>
        <label>
            <input type="radio" name="mode" value="grouped"> Grouped</label>
        <label>
            <input type="radio" name="mode" value="stacked"> Stacked</label>
        <label>
            <input type="radio" name="mode" value="grouped"> Grouped</label>
        <label>
            <input type="radio" name="mode" value="stacked"> Stacked</label>
    </form>
    <svg width="960" height="500"></svg>
    <p></p>
</body>
<script src="./d3.min.js"></script>
<!-- <script src="https://d3js.org/d3.v4.min.js"></script> -->
<script>

    var svg = d3.select("svg"),
        margin = { top: 20, right: 20, bottom: 30, left: 40 },
        width = +svg.attr("width") - margin.left - margin.right,
        height = +svg.attr("height") - margin.top - margin.bottom;

    var x = d3.scaleBand().rangeRound([0, width]).padding(0.1),
        y = d3.scaleLinear().rangeRound([height, 0]);

    var g = svg.append("g")
        .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

    // 2013-07-15 16:28:28.087000000

    d3.csv("dib.csv", function (d) {
        d['ListingCreationDate'] = new Date(d['ListingCreationDate'])
        // d.frequency = +d.frequency;
        return d;
    }).then(function (data) {
        d3.select("h1")
            .text("Prosper Loan");

        var nested = d3.nest()
            .key(function (d) {
                return d['ListingCreationDate'].getUTCFullYear();
            })
            .sortKeys(d3.ascending)
            .rollup(function (leaves) {
                var mean_BorrowerRate = d3.mean(leaves, function (d) {
                    return d['BorrowerRate'];
                });
                return {
                    'mean_BorrowerRate': mean_BorrowerRate,
                };
            })
            .entries(data);
        console.log(JSON.stringify(nested));

        x.domain(nested.map(function (d) { return d.key; }));
        y.domain([0, d3.max(nested, function (d) { return d.value.mean_BorrowerRate; })]);


        g.append("g")
            .attr("class", "axis axis--x")
            .attr("transform", "translate(0," + height + ")")
            .call(d3.axisBottom(x));

        g.append("g")
            .attr("class", "axis axis--y")
            .call(d3.axisLeft(y).ticks(10, "%"))
            .append("text")
            .attr("transform", "rotate(-90)")
            .attr("y", 6)
            .attr("dy", "0.71em")
            .attr("text-anchor", "end")
            .text("BorrowerRate");

        g.selectAll(".bar")
            .data(nested)
            .enter().append("rect")
            .attr("class", "bar")
            .attr("x", function (d) { return x(d.key); })
            .attr("y", function (d) {
                return y(d.value.mean_BorrowerRate);
            })
            .attr("width", x.bandwidth())
            .attr("height", function (d) { return height - y(d.value.mean_BorrowerRate); });
    });


      // d3.select("body")
      //     .selectAll("p")
      //     .data([4, 8, 15, 16, 23, 42])
      //     .enter()
      //     .append("p")
    //     .text(function (d) { return "Iâ€™m number " + d + "!"; });
        // d3.select("body").transition()
        // .style("background-color", "black");

</script>